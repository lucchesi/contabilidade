<!doctype html>
 
<html lang="en">
<head>
    <meta charset="iso-8859-1" />
    <title>Contabilidade</title>
	
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
    <script src="http://code.jquery.com/jquery-1.8.3.js"></script>
    <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <link rel="stylesheet" href="/resources/demos/style.css" />
	
    <script>
	//## Abas ##//
	$(function() {
		$( "#tabs" ).tabs();
	});
	
	
	//## Dados ##//
	txts = [];
	txts["0"] = [
"## Período = 31-12-X4",
"# Ativo circulante:",
"Caixa  = 400",
"Duplicatas  = 600",
"Estoques  = 1000",
"",
"# Ativo não circulante:",
"Realizável a LP   = 200",
"Investimento  = 2000",
"Imobilizado  = 1000",
"Intangível  = 1000",
"",
"# Passivo circulante:",
"Fornecedores  = 200",
"Impostos  = 2000",
"Outras dívidas  = 200",
"",
"# Passivo não circulante:",
"Exigível a LP   = 2800",
"Capital  = 800",
"Reserva de lucros  = 200",
"",
"",
"",
"## Período = 31-12-X5",
"# Ativo circulante:",
"Caixa  = 500",
"Duplicatas  = 1000",
"Estoques  = 1300",
"",
"# Ativo não circulante:",
"Realizável a LP   = 300",
"Investimento  = 1000",
"Imobilizado  = 1500",
"Intangível  = 900",
"",
"# Passivo circulante:",
"Fornecedores  = 300",
"Impostos  = 1900",
"Outras dívidas  = 500",
"",
"# Passivo não circulante:",
"Exigível a LP   = 2500",
"Capital  = 1000",
"Reserva de lucros  = 300",
""].join("\n");

	txts["1"] = [
"## Período = X1",
"# Ativo circulante:",
"Caixa = 120",
"Ações = 20",
"Estoques = 260",
"",
"# Ativo não circulante:",
"Máquinas  e equipamentos = 70",
"Móveis = 10",
"Instalações = 170",
"Aquisição marca = 100",
"",
"# Passivo circulante:",
"Impostos a pagar = 10",
"Fornecedores = 260",
"",
"# Passivo não circulante:",
"Financiamento de Longo Prazo =  200",
"Capital  = 280",
""].join("\n");

	txts["2"] = [
"## Período = X1",
"# Ativo circulante:",
"Bancos com movimento = 100",
"",
"# Ativo não circulante:",
"Instalações = 50",
"Marcas e patentes = 30",
"Participações em outras cias (controladas) = 80",
"Títulos a receber (2,5 anos)  = 70",
"Imóveis em uso = 200",
"",
"# Passivo circulante:",
"Salário a pagar = 10",
"Fornecedores = 40",
"Imposto de renda a pagar = 30",
"",
"# Passivo não circulante:",
"Capital social = 300",
"Empréstimos bancários (1,5 ano) = 50",
"Reserva de lucro = 100",
""].join("\n");

	function troca() {
		document.getElementById("dados").value = txts[ document.getElementById("select").value ];
		periodo = [];
		processa();
	}
	
	
	//## No inicio ##//
	function init() {
		document.getElementById("dados").value = txts["1"];
		for (i in txts)
			document.getElementById("select").innerHTML += "<option value=\"" + i + "\">" + i + "</option><br />";
		troca();
	}
	
	
	//## Processa tudo ##//
	function processa() {
		parseia();
		balanco();
		liquidez();
	}
	
	
	periodo = [];
	atual = null;
	
	//## Parsear os dados ##//
	function parseia() {
		banana = document.getElementById("dados").value;
		lines = banana.split("\n");
		
		// "Classe" dos periodos
		function _periodo(nome)
		{
			this.nome = nome;
			this.at_circ = [];
			this.at_n_circ = [];
			this.pa_circ = [];
			this.pa_n_circ = [];
		}
		
		
		window.ativo = false;
		window.circ = false;
		for(i in lines)
		{
			// Periodo novo
			asd = /Per[ií]odo/.exec(lines[i]);
			if(asd)
			{
				asd = lines[i].split(" = ");
				atual = asd[1];
				if(!periodo[atual])
					periodo[atual] = new _periodo(atual);
				continue;
			}
			
			// Separa as categorias
			function cebola(re, at, pass){
				asd = re.exec(lines[i]);
				if(asd)
				{
					window.ativo = at;
					window.circ = pass;
					return true;
				}
				else
					return false;
			}
			if (cebola(/Ativo circulante/, true, true)) continue;
			if (cebola(/Passivo circulante/, false, true)) continue;
			if (cebola(/Ativo não circulante/, true, false)) continue;
			if (cebola(/Passivo não circulante/, false, false)) continue;
			
			// Joga a linha na categoria atual
			if(lines[i]) {
				asd = lines[i].split(" = ");
				if(isNaN(asd[1])) continue;
				
				if(window.ativo) {
					if(circ)
						periodo[atual].at_circ[ asd[0] ] = asd[1];
					else
						periodo[atual].at_n_circ[ asd[0] ] = asd[1];
				}
				else {
					if(window.circ)
						periodo[atual].pa_circ[ asd[0] ] = asd[1];
					else
						periodo[atual].pa_n_circ[ asd[0] ] = asd[1];
				}
			}
		}
		
	}
	
	
	//## Balanço Patrimonial ##//
	function balanco()
	{
		function bal(lst) {
			k = 0;
			for (i in lst) k += parseFloat(lst[i]);
			return k;
		}
		for (atual in periodo) {
			// Ativo
			periodo[atual].AC = bal(periodo[atual].at_circ);
			periodo[atual].ANC = bal(periodo[atual].at_n_circ);
			periodo[atual].A = periodo[atual].AC + periodo[atual].ANC;
			
			// Passivo
			periodo[atual].PC = bal(periodo[atual].pa_circ);
			periodo[atual].PNC = bal(periodo[atual].pa_n_circ);
			periodo[atual].P = periodo[atual].PC + periodo[atual].PNC;
		}
		
		document.getElementById("tabs-2").innerHTML += 
			"<table>" +
			"	<tr valign=\"top\">" +
			"		<td id=\"bp_ativo\" width=50%> </td>" +
			"		<td id=\"bp_passivo\" width=50%> </td>" +
			"	</tr>" +
			"</table><br /><br />";
		
		function yadda(nam, vari, tot, n) {
			txt += 
				"		<td width=100%><b>" + nam + "</b></td>";
			// Lista os periodos
			for (i in periodo) txt += "		<td style=\"white-space:nowrap;\"><b>" + i + "</b></td>";
			txt += "	</tr>";
			
			// Cada linha
			for (i in periodo[atual][vari]) {
				txt += 
				"	<tr valign=\"top\">" +
				"		<td>" + i + "</td>";
				for (j in periodo) txt += "		<td>" + periodo[j][vari][i] + "</td>";
				txt += "	</tr>";
			}
			
			espaco(n);
			
			txt += 
				"	<tr valign=\"top\">" +
				"		<td><i>total</i></td>";
			// Lista os periodos
			for (i in periodo) txt += "		<td><i>" + periodo[i][tot] + "</i></td>";
			txt += "	</tr>";
			
			
		}
		
		function count(obj) {
			size = 0;
			for (asd in obj) size++;
			return size;
		}
		
		function espaco(n) {
			for(k=0; k < n; k++) {
				txt += "	<tr>";
				txt += "	<td>&nbsp;</td>";
				for (l in periodo)
					txt += "	<td>&nbsp;</td>";
				txt += "</tr>";
			}
		}
		
		function total(nome, vari) {
			if (nome == "Total Passivo")
				nome = "Total Passivo + PL";
			txt += 
				"	<tr valign=\"top\">" +
				"		<td><b>" + nome + "</b></td>";
			for (i in periodo) txt += "		<td><b>" + periodo[i][vari] + "</b></td>";
			txt += "	</tr>";
		}
		
		function joao(jose, joaquim, manoel, k) {
			txt = "";
			txt += 
				"<table border=1 width=100% height=100%>" +
				"	<tr valign=\"top\">";
			
			// Circulante
			n = k * ( count(periodo[atual].pa_circ) - count(periodo[atual].at_circ) );
			yadda(jose + " circulante", joaquim + "_circ", manoel + "C", n);
			espaco(1);
			
			// Não circulante
			n = k * ( count(periodo[atual].pa_n_circ) - count(periodo[atual].at_n_circ) );
			yadda(jose + " não circulante", joaquim + "_n_circ", manoel + "NC", n);
			espaco(1);
			
			total("Total " + jose, manoel);
			txt += "</table>";
			return txt;
		}
		
		document.getElementById("bp_ativo").innerHTML = joao("Ativo", "at", "A", 1);
		document.getElementById("bp_passivo").innerHTML = joao("Passivo", "pa", "P", -1);
	}
	
	
	//## Liquidez ##//
	function liquidez()
	{
		txt = ""
		for (atual in periodo){
			txt += "<b>" + atual + "</b><br />";
			//txt += "\\\[\\it\\text{Liquidez Imediata} = \\dfrac{\\it\\text{Disponível}}{\\it\\text{Passivo circulante}} \\hspace{6pt} =  \\dfrac{\\text{aaa}}{\\text{bbb}} =  c\\\]<br />\n";
			
			txt += "\\\[\\it\\text{Liquidez Corrente} = \\dfrac{\\it\\text{Ativo circulante}}{\\it\\text{Passivo circulante}} \\hspace{6pt} =  \\dfrac{" + periodo[atual].AC + "}{" + periodo[atual].PC + "} = " + (periodo[atual].AC / periodo[atual].PC).toPrecision(2) + "\\\]<br />\n";
			
			for(i in periodo[atual].at_circ) {
				asd = /Estoques/.exec(i);
				if(asd) {
					estoques = periodo[atual].at_circ[i];
					txt += "\\\[\\it\\text{Liquidez Seca} = \\dfrac{\\it\\text{Ativo circulante - Estoques}}{\\it\\text{Passivo circulante}} \\hspace{12pt} =  \\dfrac{\\text{" + periodo[atual].AC + " - " + estoques + "}}{\\text{" + periodo[atual].PC + "}} \\hspace{3pt} = " + ( (periodo[atual].AC-estoques) / periodo[atual].PC ).toPrecision(2) + "\\\]<br />\n";
				}
			}
			
			//txt += "\\\[\\it\\text{Liquidez Seca} = \\dfrac{\\it\\text{Ativo circulante + Realizável a LP}}{\\it\\text{Passivo circulante + Exigível a LP}} \\hspace{18pt} = \\dfrac{\\text{aaa + bbb}}{\\text{ccc + ddd}} \\hspace{6pt} = eee\\\]<br />\n";
		}
		
		document.getElementById("tabs-3").innerHTML = txt;
		
		MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
	}
    </script>
</head>
<body onload="javascript:init()">
 
<div id="tabs">
    <ul>
        <li><a href="#tabs-1">Entrada de dados</a></li>
        <li><a href="#tabs-2">Balanço Patrimonial (BP)</a></li>
        <li><a href="#tabs-3">Indicadores - Liquidez</a></li>
        <li><a href="#tabs-4">Demonstração de Resultado do Exercício (DRE)</a></li>
        <li><a href="#tabs-5">Indicadores - Situação econômica</a></li>
        <li><a href="#tabs-6">Demonstração dos fluxos de caixa (DFC)</a></li>
        <li><a href="#tabs-7">Demonstração dos Lucros e Prejuízos Acumulados (DLPAc)</a></li>
        <li><a href="#tabs-8">Demonstração da mutação do PL (DMPL)</a></li>
    </ul>
	
	
	
    <div id="tabs-1">
		<textarea id="dados" rows="12" cols="60"  onkeydown="javascript:processa();" onkeyup="javascript:processa();">
		</textarea><br />
		<select id="select" onChange="javascript:troca()">
		</select>
    </div>
	
    <div id="tabs-2">
    </div>
	
	
    <div id="tabs-3">
		<p>
			[EM CONSTRUÇÃO]
		</p>
    </div>
	
    <div id="tabs-4">
		<p>
			[EM CONSTRUÇÃO]
		</p>
    </div>
	
    <div id="tabs-5">
		<p>
			[EM CONSTRUÇÃO]
		</p>
    </div>
	
    <div id="tabs-6">
		<p>
			[EM CONSTRUÇÃO]
		</p>
    </div>
	
    <div id="tabs-7">
		<p>
			[EM CONSTRUÇÃO]
		</p>
    </div>
	
    <div id="tabs-8">
		<p>
			[EM CONSTRUÇÃO]
		</p>
    </div>
</div>
 
 <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            extensions: ["tex2jax.js"],
            jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$','$'], ["\\[","\\]"] ],
            processEscapes: true
            },
            TeX: {
            extensions: ["AMSmath.js", "AMSsymbols.js"]
            },
            "HTML-CSS": { availableFonts: ["TeX"] }
        });
        </script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
 
</body>
</html>

<!doctype html>
 
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Contabilidade</title>
	
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
    <script src="http://code.jquery.com/jquery-1.8.3.js"></script>
    <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <link rel="stylesheet" href="/resources/demos/style.css" />
	
    <script>
	//## Abas ##//
	$(function() {
		$( "#tabs" ).tabs();
	});
	
	
	//## Processa tudo ##//
	function processa() {
		parseia();
		balanco();
		liquidez();
	}
	
	
	//## Parsear os dados ##//
	function parseia() {
		banana = document.getElementById("dados").value;
		lines = banana.split("\n");
		
		// "Classe" dos periodos
		function _periodo()
		{
			this.nome = "X1";
			this.at_circ = [];
			this.at_n_circ = [];
			this.pa_circ = [];
			this.pa_n_circ = [];
		}
		
		periodos = [];
		periodo = null;
		periodo = new _periodo();
		
		window.ativo = false;
		window.circ = false;
		for(i in lines)
		{
			// Periodo novo
			asd = /Periodo/.exec(lines[i]);
			if(asd)
			{
				asd = lines[i].split(" = ");
				periodo.nome = asd[1];
				continue;
			}
			
			// Separa as categorias
			function cebola(re, at, pass){
				asd = re.exec(lines[i]);
				if(asd)
				{
					window.ativo = at;
					window.circ = pass;
					return true;
				}
				else
					return false;
			}
			if (cebola(/Ativo circulante/, true, true)) continue;
			if (cebola(/Passivo circulante/, false, true)) continue;
			if (cebola(/Ativo não circulante/, true, false)) continue;
			if (cebola(/Passivo não circulante/, false, false)) continue;
			
			// Joga a linha na categoria atual
			if(lines[i]) {
				asd = lines[i].split(" = ");
				if(isNaN(asd[1])) continue;
				
				if(window.ativo) {
					if(circ)
						periodo.at_circ[ asd[0] ] = asd[1];
					else
						periodo.at_n_circ[ asd[0] ] = asd[1];
				}
				else {
					if(window.circ)
						periodo.pa_circ[ asd[0] ] = asd[1];
					else
						periodo.pa_n_circ[ asd[0] ] = asd[1];
				}
			}
		}
		
	}
	
	
	//## Balanço Patrimonial ##//
	function balanco()
	{
		function bal(txt, lst) {
			k = 0;
			for (i in lst){
				txt += i + ": " + lst[i] + "</b><br />";
				k += parseFloat(lst[i]);
			}
			txt += "<i>total: " + k + "</i><br />";
			
			return [txt, k];
		}
		
		// Ativo
		tmp = bal("<b>Ativo circulante:</b><br />", periodo.at_circ);
		txt = tmp[0];
		periodo.AC = tmp[1];
		
		txt += "<br />";
		
		tmp = bal("<b>Ativo não circulante:</b><br />", periodo.at_n_circ);
		txt += tmp[0];
		periodo.ANC = tmp[1];
		
		txt += "<br />";
		
		txt += "<b><i>total ativo: " + (periodo.AC + periodo.ANC) + "</i></b><br />";
		periodo.A = periodo.AC + periodo.ANC;
		
		document.getElementById("bp_ativo").innerHTML = txt;
		
		
		// Passivo
		tmp = bal("<b>Passivo circulante:</b><br />", periodo.pa_circ);
		txt = tmp[0];
		periodo.PC = tmp[1];
		
		txt += "<br />";
		
		tmp = bal("<b>Passivo não circulante:</b><br />", periodo.pa_n_circ);
		txt += tmp[0];
		periodo.PNC = tmp[1];
		
		txt += "<br />";
		
		txt += "<b><i>total Passivo: " + (periodo.PC + periodo.PNC) + "</i></b><br />";
		periodo.P = periodo.PC + periodo.PNC;
		
		document.getElementById("bp_passivo").innerHTML = txt;
	}
	
	
	//## Liquidez ##//
	function liquidez()
	{
		txt = ""
		txt += "\\\[\\it\\text{Liquidez Imediata} = \\dfrac{\\it\\text{Disponível}}{\\it\\text{Passivo circulante}} \\hspace{6pt} =  \\dfrac{\\text{aaa}}{\\text{bbb}} =  c\\\]<br />\n";
		
		txt += "\\\[\\it\\text{Liquidez Corrente} = \\dfrac{\\it\\text{Ativo circulante}}{\\it\\text{Passivo circulante}} \\hspace{6pt} =  \\dfrac{" + periodo.AC + "}{" + periodo.PC + "} = " + (periodo.AC / periodo.PC).toPrecision(2) + "\\\]<br />\n";
		
		txt += "\\\[\\it\\text{Liquidez Seca} = \\dfrac{\\it\\text{Ativo circulante - Estoques}}{\\it\\text{Passivo circulante}} \\hspace{12pt} =  \\dfrac{\\text{aaa - bbb}}{\\text{ccc}} \\hspace{3pt} = d\\\]<br />\n";
		
		txt += "\\\[\\it\\text{Liquidez Seca} = \\dfrac{\\it\\text{Ativo circulante + Realizável a LP}}{\\it\\text{Passivo circulante + Exigível a LP}} \\hspace{18pt} = \\dfrac{\\text{aaa + bbb}}{\\text{ccc + ddd}} \\hspace{6pt} = eee\\\]<br />\n";
		
		
		document.getElementById("tabs-3").innerHTML = txt;
		
		MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
	}
    </script>
</head>
<body onload="javascript:processa()">
 
<div id="tabs">
    <ul>
        <li><a href="#tabs-1">Entrada de dados</a></li>
        <li><a href="#tabs-2">Balanço Patrimonial (BP)</a></li>
        <li><a href="#tabs-3">Indicadores – Liquidez</a></li>
        <li><a href="#tabs-4">Demonstração de Resultado do Exercício (DRE)</a></li>
        <li><a href="#tabs-5">Indicadores – Situação econômica</a></li>
        <li><a href="#tabs-6">Demonstração dos fluxos de caixa (DFC)</a></li>
        <li><a href="#tabs-7">Demonstração dos Lucros e Prejuízos Acumulados (DLPAc)</a></li>
        <li><a href="#tabs-8">Demonstração da mutação do PL (DMPL)</a></li>
    </ul>
	
	
	
    <div id="tabs-1">
		<textarea id="dados" rows="12" cols="60"  onkeydown="javascript:processa();" onkeyup="javascript:processa();">
## Período = X1
# Ativo circulante:
Caixa = 120
Ações = 20
Estoques = 260

# Ativo não circulante:
Máquinas  e equipamentos = 70
Móveis = 10
Instalações = 170
Aquisição marca = 100

# Passivo circulante:
Impostos a pagar = 10
Fornecedores = 260

# Passivo não circulante:
Financiamento de Longo Prazo =  200
Capital  = 280
		</textarea><br />
    </div>
	
    <div id="tabs-2">
		<table>
			<tr valign="top">
				<td id="bp_ativo"> </td>
				<td id="bp_passivo"> </td>
			</tr>
		</table>
    </div>
	
	
    <div id="tabs-3">
		<p>
			[EM CONSTRUÇÃO]
		</p>
    </div>
	
    <div id="tabs-4">
		<p>
			[EM CONSTRUÇÃO]
		</p>
    </div>
	
    <div id="tabs-5">
		<p>
			[EM CONSTRUÇÃO]
		</p>
    </div>
	
    <div id="tabs-6">
		<p>
			[EM CONSTRUÇÃO]
		</p>
    </div>
	
    <div id="tabs-7">
		<p>
			[EM CONSTRUÇÃO]
		</p>
    </div>
	
    <div id="tabs-8">
		<p>
			[EM CONSTRUÇÃO]
		</p>
    </div>
</div>
 
 <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            extensions: ["tex2jax.js"],
            jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$','$'], ["\\[","\\]"] ],
            processEscapes: true
            },
            TeX: {
            extensions: ["AMSmath.js", "AMSsymbols.js"]
            },
            "HTML-CSS": { availableFonts: ["TeX"] }
        });
        </script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
 
</body>
</html>
